<!-- ... existing code ... -->
            {
                name: 'Makaron ze szpinakiem i czosnkiem',
<!-- ... existing code ... -->
                    text: 'Kup zestaw garnków i patelni',
                    url: '#' // TUTAJ TWÓJ LINK AFILIACYJNY
                }
            },
            {
                name: 'Kopytka leniwe (na słodko)',
                ingredients: ['twarog', 'jajka', 'maka', 'cukier', 'maslo'],
                instructions: 'Twaróg rozgnieć z jajkiem i cukrem. Dodaj mąkę i zagnieć miękkie ciasto. Uformuj wałeczki, krój kluski. Gotuj w osolonej wodzie ok. 2-3 min od wypłynięcia. Podawaj z roztopionym masłem.',
                affiliateLink: {
                    text: 'Zobacz stolnice i wałki do ciasta',
                    url: '#' // TUTAJ TWÓJ LINK AFILIACYJNY
                }
            },
            {
                name: 'Szybka zupa krem z czerwonej soczewicy',
                ingredients: ['soczewica', 'marchew', 'cebula', 'czosnek', 'bulion', 'oliwa'],
                instructions: 'Na oliwie podsmaż posiekaną cebulę, czosnek i startą marchew. Dodaj soczewicę (wypłukaną) i zalej bulionem. Gotuj ok. 15-20 min, aż soczewica będzie miękka. Zblenduj na krem. (Opcjonalnie: mleko kokosowe).',
                affiliateLink: {
                    text: 'Niezbędny do zup-kremów: Blender ręczny',
                    url: '#' // TUTAJ TWÓJ LINK AFILIACYJNY
                }
            }
        ];

        // --- LOGIKA APLIKACJI ---

        document.addEventListener('DOMContentLoaded', () => {
            const filtersContainer = document.getElementById('ingredient-filters');
            const findBtn = document.getElementById('find-recipe-btn');
            const resultsContainer = document.getElementById('recipe-results');
            const noResultsEl = document.getElementById('no-results');
            const resultsTitle = document.getElementById('results-title');

            // NOWE ELEMENTY DOM
            const addIngredientForm = document.getElementById('add-ingredient-form');
            const newIngredientNameInput = document.getElementById('new-ingredient-name');
            const addIngredientError = document.getElementById('add-ingredient-error');
            
            const addRecipeForm = document.getElementById('add-recipe-form');
            const newRecipeNameInput = document.getElementById('new-recipe-name');
            const newRecipeInstructionsInput = document.getElementById('new-recipe-instructions');
            const newRecipeIngredientsContainer = document.getElementById('new-recipe-ingredients');
            const newRecipeIngredientsError = document.getElementById('add-recipe-ingredients-error');
            const newAffiliateTextInput = document.getElementById('new-affiliate-text');
            const newAffiliateUrlInput = document.getElementById('new-affiliate-url');
            const addRecipeSuccess = document.getElementById('add-recipe-success');

            // --- NOWA FUNKCJA: Renderowanie checkboxów ze składnikami (w głównym filtrze) ---
            function renderIngredientFilters() {
                filtersContainer.innerHTML = ''; // Wyczyść
                allIngredients
                    .sort((a, b) => a.name.localeCompare(b.name, 'pl')) // Sortuj alfabetycznie po polsku
                    .forEach(ingredient => {
                        const label = document.createElement('label');
                        label.className = 'flex items-center space-x-2 cursor-pointer hover:bg-emerald-50 p-2 rounded-lg transition-colors';
                        label.innerHTML = `
                            <input type="checkbox" id="filter_${ingredient.id}" value="${ingredient.id}" class="h-5 w-5 rounded text-emerald-600 focus:ring-emerald-500 border-gray-300">
                            <span class="text-gray-700">${ingredient.name}</span>
                        `;
                        filtersContainer.appendChild(label);
                    });
            }

             // --- NOWA FUNKCJA: Renderowanie checkboxów ze składnikami (w formularzu dodawania przepisu) ---
            function renderRecipeIngredientCheckboxes() {
                newRecipeIngredientsContainer.innerHTML = ''; // Wyczyść
                allIngredients
                    .sort((a, b) => a.name.localeCompare(b.name, 'pl')) // Sortuj alfabetycznie
                    .forEach(ingredient => {
                        const label = document.createElement('label');
                        label.className = 'flex items-center space-x-2 cursor-pointer hover:bg-gray-100 p-1.5 rounded';
                        label.innerHTML = `
                            <input type="checkbox" id="recipe_ing_${ingredient.id}" value="${ingredient.id}" class="h-4 w-4 rounded text-emerald-600 focus:ring-emerald-500 border-gray-300">
                            <span class="text-sm text-gray-700">${ingredient.name}</span>
                        `;
                        newRecipeIngredientsContainer.appendChild(label);
                    });
            }

            // --- NOWA FUNKCJA: Generowanie "slug" ID dla nowego składnika ---
            function createIngredientId(name) {
                return name.toLowerCase()
                           .trim()
                           .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // Usuń diakrytyki (polskie znaki)
                           .replace(/ł/g, 'l') // Specjalna obsługa 'ł'
                           .replace(/[^a-z0-9\s-]/g, '') // Usuń znaki specjalne
                           .replace(/[\s-]+/g, '_'); // Zamień spacje i myślniki na _
            }

            // 1. Inicjalne renderowanie list
            renderIngredientFilters();
            renderRecipeIngredientCheckboxes();


            // 2. Obsługa kliknięcia przycisku "Znajdź" (bez zmian)
            findBtn.addEventListener('click', () => {
                // Zbierz zaznaczone składniki
                const selectedIngredients = [];
                filtersContainer.querySelectorAll('input[type="checkbox"]:checked').forEach(input => {
                    selectedIngredients.push(input.value);
                });

                // Sprawdź, które przepisy można zrobić
                // Logika: przepis jest pasujący, jeśli WSZYSTKIE jego składniki są na liście zaznaczonych
                const foundRecipes = allRecipes.filter(recipe => {
                    // Ochrona przed błędnymi danymi (jeśli przepis nie ma składników)
                    if (!recipe.ingredients) return false;
                    return recipe.ingredients.every(reqIngredient => 
                        selectedIngredients.includes(reqIngredient)
                    );
                });

                renderResults(foundRecipes);
            });

            // 3. Renderowanie wyników (z poprawką na nazwy składników)
            function renderResults(recipes) {
                resultsContainer.innerHTML = ''; // Wyczyść stare wyniki

                if (recipes.length === 0) {
                    noResultsEl.style.display = 'block';
                    resultsTitle.style.display = 'none';
                } else {
                    noResultsEl.style.display = 'none';
                    resultsTitle.style.display = 'block';

                    recipes.forEach(recipe => {
                        const card = document.createElement('div');
                        card.className = 'bg-white p-6 rounded-lg shadow-md border border-gray-200 recipe-card';
                        
                        // ZMIANA: Pokaż pełne nazwy składników, a nie tylko ich ID
                        const ingredientNames = recipe.ingredients.map(id => {
                            const found = allIngredients.find(ing => ing.id === id);
                            return found ? found.name : id; // Pokaż nazwę lub ID, jeśli nie znaleziono
                        }).join(', ');

                        card.innerHTML = `
                            <!-- ZMIANA: Nowy kolor tytułu przepisu -->
                            <h3 class="text-xl font-bold text-emerald-800 mb-3">${recipe.name}</h3>
                            <p class="text-gray-600 mb-4 whitespace-pre-wrap">${recipe.instructions}</p>
                            <p class="text-sm text-gray-500 mb-4">
                                <strong>Wymagane:</strong> ${ingredientNames}
                            </p>
                            <!-- TUTAJ ELEMENT MONETYZACJI -->
                            <!-- ZMIANA: Nowy kolor linku afiliacyjnego -->
                            <a href="${recipe.affiliateLink.url}" target="_blank" rel="noopener sponsored"
                               class="inline-block text-sm font-medium text-emerald-600 hover:text-emerald-800 transition-colors duration-200">
                                ${recipe.affiliateLink.text} &rarr;
                            </a>
                        `;
                        resultsContainer.appendChild(card);
                    });
                }
            }

            // --- NOWA LOGIKA: Obsługa formularza dodawania SKŁADNIKA ---
            addIngredientForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = newIngredientNameInput.value.trim();
                if (!name) return;

                const id = createIngredientId(name);

                // Sprawdź duplikaty
                const exists = allIngredients.some(ing => ing.id === id || ing.name.toLowerCase() === name.toLowerCase());
                
                if (exists) {
                    addIngredientError.textContent = `Składnik "${name}" już istnieje na liście.`;
                    addIngredientError.style.display = 'block';
                    setTimeout(() => { addIngredientError.style.display = 'none'; }, 3000);
                } else {
                    // Dodaj do globalnej listy
                    allIngredients.push({ id, name });
                    
                    // Przesortuj i odśwież obie listy checkboxów
                    renderIngredientFilters();
                    renderRecipeIngredientCheckboxes();

                    // Wyczyść formularz
                    newIngredientNameInput.value = '';
                    addIngredientError.style.display = 'none';
                }
            });

            // --- NOWA LOGIKA: Obsługa formularza dodawania PRZEPISU ---
            addRecipeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                newRecipeIngredientsError.style.display = 'none';
                
                // 1. Zbierz dane
                const name = newRecipeNameInput.value.trim();
                const instructions = newRecipeInstructionsInput.value.trim();
                const affiliateText = newAffiliateTextInput.value.trim();
                const affiliateUrl = newAffiliateUrlInput.value.trim();

                // 2. Zbierz zaznaczone składniki
                const selectedIngredients = [];
                newRecipeIngredientsContainer.querySelectorAll('input[type="checkbox"]:checked').forEach(input => {
                    selectedIngredients.push(input.value);
                });

                // 3. Walidacja
                if (!name || !instructions || selectedIngredients.length === 0) {
                    if (selectedIngredients.length === 0) {
                        newRecipeIngredientsError.style.display = 'block';
                    }
                    return; // Nie wysyłaj, jeśli brakuje danych
                }

                // 4. Stwórz nowy obiekt przepisu
                const newRecipe = {
                    name: name,
                    ingredients: selectedIngredients,
                    instructions: instructions,
                    affiliateLink: {
                        text: affiliateText || 'Sprawdź polecany produkt', // Domyślny tekst
                        url: affiliateUrl || '#' // Domyślny URL
                    }
                };

                // 5. Dodaj do globalnej listy
                allRecipes.push(newRecipe);
                
                // 6. Resetuj formularz i pokaż sukces
                addRecipeForm.reset();
                // Checkboxy trzeba ręcznie odznaczyć po resecie formularza
                newRecipeIngredientsContainer.querySelectorAll('input[type="checkbox"]:checked').forEach(input => {
                    input.checked = false;
                });

                addRecipeSuccess.style.display = 'block';
                setTimeout(() => { addRecipeSuccess.style.display = 'none'; }, 4000);
            });
        });
    </script>
</body>
</html>
